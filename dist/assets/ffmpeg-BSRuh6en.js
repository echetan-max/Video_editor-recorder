var i;(function(r){r.LOAD="LOAD",r.EXEC="EXEC",r.FFPROBE="FFPROBE",r.WRITE_FILE="WRITE_FILE",r.READ_FILE="READ_FILE",r.DELETE_FILE="DELETE_FILE",r.RENAME="RENAME",r.CREATE_DIR="CREATE_DIR",r.LIST_DIR="LIST_DIR",r.DELETE_DIR="DELETE_DIR",r.ERROR="ERROR",r.DOWNLOAD="DOWNLOAD",r.PROGRESS="PROGRESS",r.LOG="LOG",r.MOUNT="MOUNT",r.UNMOUNT="UNMOUNT"})(i||(i={}));const d=(()=>{let r=0;return()=>r++})(),f=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),h=new Error("called FFmpeg.terminate()");class l{#e=null;#s={};#r={};#i=[];#a=[];loaded=!1;#E=()=>{this.#e&&(this.#e.onmessage=({data:{id:t,type:e,data:s}})=>{switch(e){case i.LOAD:this.loaded=!0,this.#s[t](s);break;case i.MOUNT:case i.UNMOUNT:case i.EXEC:case i.FFPROBE:case i.WRITE_FILE:case i.READ_FILE:case i.DELETE_FILE:case i.RENAME:case i.CREATE_DIR:case i.LIST_DIR:case i.DELETE_DIR:this.#s[t](s);break;case i.LOG:this.#i.forEach(a=>a(s));break;case i.PROGRESS:this.#a.forEach(a=>a(s));break;case i.ERROR:this.#r[t](s);break}delete this.#s[t],delete this.#r[t]})};#t=({type:t,data:e},s=[],a)=>this.#e?new Promise((R,n)=>{const E=d();this.#e&&this.#e.postMessage({id:E,type:t,data:e},s),this.#s[E]=R,this.#r[E]=n,a?.addEventListener("abort",()=>{n(new DOMException(`Message # ${E} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(f);on(t,e){t==="log"?this.#i.push(e):t==="progress"&&this.#a.push(e)}off(t,e){t==="log"?this.#i=this.#i.filter(s=>s!==e):t==="progress"&&(this.#a=this.#a.filter(s=>s!==e))}load=({classWorkerURL:t,...e}={},{signal:s}={})=>(this.#e||(this.#e=t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"}),this.#E()),this.#t({type:i.LOAD,data:e},void 0,s));exec=(t,e=-1,{signal:s}={})=>this.#t({type:i.EXEC,data:{args:t,timeout:e}},void 0,s);ffprobe=(t,e=-1,{signal:s}={})=>this.#t({type:i.FFPROBE,data:{args:t,timeout:e}},void 0,s);terminate=()=>{const t=Object.keys(this.#r);for(const e of t)this.#r[e](h),delete this.#r[e],delete this.#s[e];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(t,e,{signal:s}={})=>{const a=[];return e instanceof Uint8Array&&a.push(e.buffer),this.#t({type:i.WRITE_FILE,data:{path:t,data:e}},a,s)};mount=(t,e,s)=>{const a=[];return this.#t({type:i.MOUNT,data:{fsType:t,options:e,mountPoint:s}},a)};unmount=t=>{const e=[];return this.#t({type:i.UNMOUNT,data:{mountPoint:t}},e)};readFile=(t,e="binary",{signal:s}={})=>this.#t({type:i.READ_FILE,data:{path:t,encoding:e}},void 0,s);deleteFile=(t,{signal:e}={})=>this.#t({type:i.DELETE_FILE,data:{path:t}},void 0,e);rename=(t,e,{signal:s}={})=>this.#t({type:i.RENAME,data:{oldPath:t,newPath:e}},void 0,s);createDir=(t,{signal:e}={})=>this.#t({type:i.CREATE_DIR,data:{path:t}},void 0,e);listDir=(t,{signal:e}={})=>this.#t({type:i.LIST_DIR,data:{path:t}},void 0,e);deleteDir=(t,{signal:e}={})=>this.#t({type:i.DELETE_DIR,data:{path:t}},void 0,e)}var o;(function(r){r.MEMFS="MEMFS",r.NODEFS="NODEFS",r.NODERAWFS="NODERAWFS",r.IDBFS="IDBFS",r.WORKERFS="WORKERFS",r.PROXYFS="PROXYFS"})(o||(o={}));const c=r=>new Promise((t,e)=>{const s=new FileReader;s.onload=()=>{const{result:a}=s;a instanceof ArrayBuffer?t(new Uint8Array(a)):t(new Uint8Array)},s.onerror=a=>{e(Error(`File could not be read! Code=${a?.target?.error?.code||-1}`))},s.readAsArrayBuffer(r)}),D=async r=>{let t;if(typeof r=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?t=atob(r.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(r)).arrayBuffer();else if(r instanceof URL)t=await(await fetch(r)).arrayBuffer();else if(r instanceof File||r instanceof Blob)t=await c(r);else return new Uint8Array;return new Uint8Array(t)};export{l as F,D as f};
